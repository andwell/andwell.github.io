<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <title>Guo&#39;s Page</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Guo's Page">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Guo's Page">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Guo's Page">
  
    <link rel="alternative" href="/atom.xml" title="Guo&#39;s Page" type="application/atom+xml">
  
  
    <link rel="icon" href="//favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="null./images/favicon.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Fangqing Guo</a></h1>
		</hgroup>

		
		<p class="header-subtitle">iOS随笔杂文</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						<div class="icon-wrap icon-link hide" data-idx="2">
							<div class="loopback_l"></div>
							<div class="loopback_r"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>Menu</li>
						<li>Tags</li>
						
						<li>Links</li>
						
						
						<li>Über</li>
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
								<a class="github" target="_blank" href="#" title="github">github</a>
					        
								<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
					        
								<a class="rss" target="_blank" href="#" title="rss">rss</a>
					        
								<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
					        
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						
					</div>
				</section>
				
				
				
				<section class="switch-part switch-part3">
					<div id="js-friends">
					
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">奥巴马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">卡卡的美丽传说</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">本泽马的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">吉格斯的博客</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">习大大大不同</a>
			        
			          <a target="_blank" class="main-nav-link switch-friends-link" href="http://localhost:4000/">托蒂的博客</a>
			        
			        </div>
				</section>
				

				
				
				<section class="switch-part switch-part4">
				
					<div id="js-aboutme">我是谁，我从哪里来，我到哪里去？我就是我，是颜色不一样的吃货…</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>

    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Fangqing Guo</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				
					<img lazy-src="null./images/favicon.png" class="js-avatar">
				
			</div>
			<hgroup>
			  <h1 class="header-author">Fangqing Guo</h1>
			</hgroup>
			
			<p class="header-subtitle">iOS随笔杂文</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="#" title="github">github</a>
			        
						<a class="weibo" target="_blank" href="#" title="weibo">weibo</a>
			        
						<a class="rss" target="_blank" href="#" title="rss">rss</a>
			        
						<a class="zhihu" target="_blank" href="#" title="zhihu">zhihu</a>
			        
				</div>
			</nav>
		</header>				
	</div>
</nav>

      <div class="body-wrap">
  
    <article id="post-2015-06-16-iosdong-tai-geng-xin-frameworkshi-xian" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2015/06/16/2015-06-16-iosdong-tai-geng-xin-frameworkshi-xian/" class="article-date">
  	<time datetime="2015-06-16T15:49:26.000Z" itemprop="datePublished">2015-06-16</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/06/16/2015-06-16-iosdong-tai-geng-xin-frameworkshi-xian/">IOS动态更新--framework实现</a>
    </h1>
  

      </header>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="程序从编辑到运行经历的阶段"><a href="#程序从编辑到运行经历的阶段" class="headerlink" title="程序从编辑到运行经历的阶段"></a>程序从编辑到运行经历的阶段</h3><p>预编译 &gt;&gt; 编译(Compile) &gt;&gt; 链接(Link) &gt;&gt; 运行(Run)<br>众所周知<strong>Objective-C</strong>为消息型语言，与<strong>C++/Java</strong>不同的是将一些决定从编译和链接时推迟到运行时。</p>
<h2 id="什么是Framework"><a href="#什么是Framework" class="headerlink" title="什么是Framework"></a>什么是Framework</h2><p>所谓Framework从字面来看就是个<strong>框架</strong>，此框架并非架构、设计而言的结果，而是相对文件组成而言的封装。</p>
<h3 id="framework由什么组成"><a href="#framework由什么组成" class="headerlink" title="framework由什么组成"></a>framework由什么组成</h3><p>用苹果自己的话就是:</p>
<blockquote>
<p><em>Frameworks are a collection of code and resources to encapsulate functionality…</em>   </p>
</blockquote>
<p>简单来说就是 <strong>资源+代码</strong> 等文件的集成。如下图: 百度地图SDK<br><img src="/images/framework.png" alt=""> </p>
<h3 id="怎么制作framework"><a href="#怎么制作framework" class="headerlink" title="怎么制作framework"></a>怎么制作framework</h3><p>苹果的库有<strong>静态库(.a)</strong>、<strong>动态库(.dylib)</strong>，早期第三方项目的代码像分享SDK或者openssl依赖库等都是封装成<code>.a</code>的静态库的形式开放的，当然也有不少会做成<code>伪framework</code>的形式(早期Facebook的SDK就是)，像我们以前制作的游戏SDK，其实就是通过脚本把静态库打包成类framework的包。<br><br>然而Apple在2014<em>WWDC</em>大会首次开放了IOS官方制作framework的功能，并集成到了<strong>XCode6</strong>当中。<a href="https://developer.apple.com/library/prerelease/ios/documentation/DeveloperTools/Conceptual/WhatsNewXcode/Articles/xcode_6_0.html" target="_blank" rel="external">参考官方介绍</a></p>
<blockquote>
<p><em>Frameworks for iOS. iOS developers can now create dynamic frameworks. Frameworks are a collection of code and resources to encapsulate functionality that is valuable across multiple projects. Frameworks work perfectly with extensions, sharing logic that can be used by both the main application and the bundled extensions.</em>   </p>
</blockquote>
<p>很多人都会疑惑一点：为什么是dynamic framework?<br>难道Apple已开放以framework来动态更新，这其实是个模棱两可的态度。但至少我们认清一个概念: framework分为两种<strong><code>static</code></strong>&amp;<strong><code>dynamic</code></strong>.<br>关于制作方式，网上搜索已经一大堆了，比如<a href="http://blog.csdn.net/like7xiaoben/article/details/44081257" target="_blank" rel="external">参考这篇</a>. </p>
<h3 id="制作framework当中的问题"><a href="#制作framework当中的问题" class="headerlink" title="制作framework当中的问题"></a>制作framework当中的问题</h3><p>既然网上制作方式一大堆，为什么还要写这篇博文呢？出于以下几点:<br>  </p>
<ul>
<li>很多人制作完以后真机不能使用或者报各种错</li>
<li>怎么作签名认证(嵌入provision)</li>
<li>认清应用场景(动态更新)<br><br><br><br>1.真机不能使主要原因在于没有作签名认证。<br>2.签名认证方式:比较简单，在制作framework时选择好相应的code signing<code>Identity</code>和<code>Provisioning Profile</code>即可。<br><img src="/images/framework2.png" alt="">由图上可看出与开放型framework不同的是多了个embedded.mobileprovision文件。<br>同时是支持IOS6及以下的，真机、模拟器皆可。<a href="https://github.com/andwell/Framework" target="_blank" rel="external">代码demo</a><br></li>
</ul>
<h3 id="动态framework运作"><a href="#动态framework运作" class="headerlink" title="动态framework运作"></a>动态framework运作</h3><p>动态库允许应用在需要时将代码内存地址动态的加载，无论是应用启动时还是运行时都可以动态去加载<a href="http://ddeville.me/2014/04/dynamic-linking/" target="_blank" rel="external">参考文章</a>。正如<strong>前言</strong>中提到的最后一步便可按需加载，所以可以为我们在IOS的动态更新当中提供可行性。<br>而在IOS当中苹果有开放的动态实现接口: <code>dlopen</code>加载动态库</p>
<h3 id="苹果审核可行性"><a href="#苹果审核可行性" class="headerlink" title="苹果审核可行性"></a>苹果审核可行性</h3><p>依照苹果审核条例，不允许进行动态更新，所以这一点就是不可避免的风险。<br>如何机智规避：   </p>
<ol>
<li>避免使用dlopen方式加载动态库(上传时便能字符串检测到) 替换方案:<pre><code class="objective-c">NSBundle *bundle = [NSBundle bundleWithPath:frameworkPath];
 if ([bundle loadAndReturnError:&amp;err]) {
     Class frameClass = NSClassFromString(@&quot;AnyFrameworkClass&quot;);
     if (frameClass != nil){
         // alloc and initizal
     }
 }
</code></pre>
</li>
<li>不直接存储.framework文件在沙盒当中，加密或者解压加载后即焚。<br><br><strong>当然这依然还是避免不了人为举报风险（还需酌情使用）</strong></li>
</ol>
<h2 id="IOS动态更新"><a href="#IOS动态更新" class="headerlink" title="IOS动态更新"></a>IOS动态更新</h2><h3 id="动态更新可行方案"><a href="#动态更新可行方案" class="headerlink" title="动态更新可行方案"></a>动态更新可行方案</h3><p>ios应用当中动态更新，目前有几个可行性方案主要包括以下几种:        </p>
<ul>
<li>web加载式动态更新(最常用最古老的方式)</li>
<li>lua文件控制动态更新(最麻烦最糟糕的方式)</li>
<li>react native框架js动态更新(最时髦的方式)</li>
<li>framework模块化后动态库式更新(最危险的方式)    </li>
</ul>
<p>1.第一种主流还是依靠<code>phonegap</code>框架的<code>hybird</code>应用，动态部分依赖web页面来动态改变更新。但在用户体验、native交互方面依然还是硬伤。<br>2.第二种主要是在runtime动态替换object相应的方法或属性来达到动态更新的效果。但<code>.lua</code>文件的编写是个很痛苦的过程，先不说没有相对智能的开发工具，更大的死穴是无调试工具支持。<br>3.React Native是近期Facebook开源的新框架，意在用js开发native APP，目前仅IOS开放开源项目(Android版也将临近)，显而易见修改部分js便可达到动态更新。这需要RD具备js开发技能便足够。<br>4.framework方式便是这篇文章主旨。    </p>
<p>下载并解压当前主流的APP便能看出其使用了何种方案，以下是我看到的结果:       </p>
<ul>
<li>QQ使用了lua来动态更新部分页面</li>
<li>天猫ipad版使用了react native框架</li>
<li>大部分还是Hybird APP</li>
<li>暂未发现有framework动态更新的应用(很遗憾)<br></li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li>类游戏应用关卡  </li>
<li>组件化的插件/模块 (类似支付宝插件)</li>
<li>修复线上模块bug (前提是提取出的组件化模块)</li>
</ol>

      
    </div>
    
    <div class="article-info article-info-index">
      
      
      

      
      <div class="clearfix"></div>
    </div>
    
  </div>
  
</article>









  
  
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Fangqing Guo
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		root: /
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>